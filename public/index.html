<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rielaboratore di Maiuscole</title>
  <link rel="icon" href="favicon.ico">
  <style>
    :root {
      --blue-accent: #2563eb;
      --blue-light: #eff6ff;
      --text-dark: #1f2937;
      --text-light: #6b7280;
      --border-color: #d1d5db;
      --background-light: #f9fafb;
      --background-white: #ffffff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--background-light);
      min-height: 100vh;
      color: var(--text-dark);
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* --- Stile Header Ripristinato --- */
    .header {
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      border-radius: 12px;
      padding: 40px 30px;
      margin-bottom: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .header h1 {
      font-size: 2.5rem;
      color: #1e3a8a; /* Colore testo per contrasto con giallo */
      font-weight: 700;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1rem;
      color: #1e40af; /* Colore testo per contrasto con giallo */
      font-weight: 500;
    }
    /* --- Fine Stile Header --- */

    .main-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .section {
      background: var(--background-white);
      border-radius: 12px;
      padding: 30px;
      border: 1px solid #e5e7eb;
    }

    .section-title {
      font-size: 1.5rem;
      color: var(--text-dark);
      font-weight: 600;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .section-title::before {
      content: '';
      width: 4px;
      height: 24px;
      background-color: var(--blue-accent);
      border-radius: 2px;
    }
    
    textarea {
      width: 100%;
      min-height: 200px;
      padding: 15px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
      transition: all 0.3s ease;
      resize: vertical;
      background: var(--background-light);
      overflow-y: hidden;
    }

    textarea:focus {
      outline: none;
      border-color: var(--blue-accent);
      box-shadow: 0 0 0 3px var(--blue-light);
      background: var(--background-white);
    }

    textarea::placeholder {
      color: #9ca3af;
      font-style: italic;
    }

    .button-container {
      display: flex;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 10px 20px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      background-color: transparent;
      color: var(--text-light);
    }

    .btn .icon {
      color: var(--blue-accent);
    }

    .btn:hover {
      background-color: var(--blue-light);
      border-color: var(--blue-accent);
      color: var(--text-dark);
    }

    .btn:active {
      transform: scale(0.98);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      background-color: var(--background-light);
      color: var(--text-light);
    }

    /* Classi di stato temporanee */
    .btn-loading {
      background-color: var(--text-light) !important;
      border-color: var(--text-light) !important;
      color: white !important;
      cursor: not-allowed !important;
    }

    .btn-success {
      background: #10b981 !important;
      border-color: #10b981 !important;
      color: white !important;
    }

    .btn-error {
      background: #ef4444 !important;
      border-color: #ef4444 !important;
      color: white !important;
    }
    
    .output-area {
      background: var(--background-light);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 20px;
      min-height: 200px;
      font-family: inherit;
      font-size: 16px;
      white-space: pre-wrap;
      word-wrap: break-word;
      line-height: 1.7;
      color: var(--text-dark);
    }

    .output-area:not(:empty) {
      background: var(--background-white);
    }

    .status {
      margin-top: 15px;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      display: none;
    }

    .status.show { display: block; animation: fadeIn 0.3s ease; }
    .status.info { background: #e0f2fe; color: #075985; border: 1px solid #bae6fd; }
    .status.success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
    .status.error { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
    .status.warning { background: #fef3c7; color: #92400e; border: 1px solid #fde047; }

    .icon { width: 18px; height: 18px; display: inline-block; }
    .spinner { width: 16px; height: 16px; border: 2px solid #ffffff; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes fadeIn { 0% { opacity: 0; transform: translateY(-10px); } 100% { opacity: 1; transform: translateY(0); } }

    .instructions { background: var(--background-white); border-radius: 12px; padding: 25px; margin-top: 30px; border: 1px solid #e5e7eb; }
    .instructions h3 { color: var(--text-dark); font-size: 1.3rem; margin-bottom: 15px; font-weight: 600; }
    .instructions ul { list-style: none; padding-left: 0; }
    .instructions li { padding: 8px 0; display: flex; align-items: center; gap: 10px; color: var(--text-light); }
    .instructions li::before { content: '✓'; color: var(--blue-accent); font-weight: bold; font-size: 1.1rem; }

    @media (max-width: 768px) {
      .main-content { grid-template-columns: 1fr; gap: 20px; }
      .header h1 { font-size: 2rem; }
      .section { padding: 20px; }
      .button-container { flex-direction: column; }
      .btn { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Rielaboratore di Maiuscole</h1>
      <p>Trasforma il tuo testo in un formato elegante e leggibile</p>
    </div>

    <div class="main-content">
      <div class="section input-section">
        <h2 class="section-title">Testo da Elaborare</h2>
        <textarea 
          id="inputText" 
          placeholder="Incolla qui il testo scritto tutto in maiuscolo che vuoi rielaborare..."
        ></textarea>
        <div class="button-container">
          <button class="btn" onclick="uniforma()" id="uniformaBtn">
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c.251.047.502.1.752.172m0 0c.25.072.498.16.746.255m3.838-3.718c.63.23.966.941.966 1.591v4.684a2.25 2.25 0 01-1.88 2.185M18.75 4.5l-1.5 1.5m0 0l-1.5-1.5M18.75 4.5v9" /></svg>
            </span>
            <span class="text">Rielabora Testo</span>
          </button>
          <button class="btn" onclick="salvaContenuti()">
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
            </span>
            <span class="text">Salva</span>
          </button>
          <button class="btn" onclick="cancellaTutto()">
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" /></svg>
            </span>
            <span class="text">Cancella Tutto</span>
          </button>
        </div>
        <div id="inputStatus" class="status"></div>
      </div>

      <div class="section output-section">
        <h2 class="section-title">Risultato Elaborato</h2>
        <div id="outputText" class="output-area"></div>
        <div class="button-container">
          <button class="btn" onclick="copiaRisultato()" id="copiaBtn">
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75" /></svg>
            </span>
            <span class="text">Copia Risultato</span>
          </button>
        </div>
        <div id="outputStatus" class="status"></div>
      </div>
    </div>

    <div class="instructions">
      <h3>Come Utilizzare il Rielaboratore</h3>
      <ul>
        <li>Incolla il testo maiuscolo nell'area di input.</li>
        <li>Clicca su "Rielabora Testo" per avviare l'elaborazione.</li>
        <li>Il sistema trasformerà il testo in un formato più leggibile.</li>
        <li>Puoi salvare i testi nel browser con "Salva" o copiare il risultato finale.</li>
      </ul>
    </div>
  </div>

  <script>
    const inputText = document.getElementById('inputText');
    const outputText = document.getElementById('outputText');
    const inputStatus = document.getElementById('inputStatus');
    const outputStatus = document.getElementById('outputStatus');
    const uniformaBtn = document.getElementById('uniformaBtn');
    const copiaBtn = document.getElementById('copiaBtn');

    function autoResizeTextarea(element) {
      element.style.height = 'auto';
      element.style.height = (element.scrollHeight) + 'px';
    }

    async function uniforma() {
      const input = inputText.value.trim();
      const btnText = uniformaBtn.querySelector('.text');
      const btnIcon = uniformaBtn.querySelector('.icon');

      if (!input) {
        showStatus(inputStatus, "⚠️ Inserisci del testo da rielaborare.", "warning");
        return;
      }

      uniformaBtn.classList.add('btn-loading');
      uniformaBtn.disabled = true;
      btnIcon.innerHTML = '<div class="spinner"></div>';
      btnText.textContent = 'Elaborazione...';
      showStatus(inputStatus, "⏳ Elaborazione in corso...", "info", true);

      try {
        const response = await fetch('/api/uniforma', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ input })
        });
        const data = await response.json();
        if (data.choices && data.choices[0] && data.choices[0].message) {
          outputText.innerText = data.choices[0].message.content;
          uniformaBtn.classList.remove('btn-loading');
          uniformaBtn.classList.add('btn-success');
          btnIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg>';
          btnText.textContent = 'Completato!';
          showStatus(inputStatus, "✅ Testo rielaborato con successo!", "success");
          setTimeout(() => {
            uniformaBtn.classList.remove('btn-success');
            uniformaBtn.disabled = false;
            btnIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c.251.047.502.1.752.172m0 0c.25.072.498.16.746.255m3.838-3.718c.63.23.966.941.966 1.591v4.684a2.25 2.25 0 01-1.88 2.185M18.75 4.5l-1.5 1.5m0 0l-1.5-1.5M18.75 4.5v9" /></svg>';
            btnText.textContent = 'Rielabora Testo';
          }, 2000);
        } else {
          throw new Error('Risposta inattesa dal server');
        }
      } catch (err) {
        outputText.innerText = "";
        uniformaBtn.classList.remove('btn-loading');
        uniformaBtn.classList.add('btn-error');
        btnIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>';
        btnText.textContent = 'Errore!';
        showStatus(inputStatus, "❌ Errore durante l'elaborazione. Riprova.", "error");
        setTimeout(() => {
          uniformaBtn.classList.remove('btn-error');
          uniformaBtn.disabled = false;
          btnIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c.251.047.502.1.752.172m0 0c.25.072.498.16.746.255m3.838-3.718c.63.23.966.941.966 1.591v4.684a2.25 2.25 0 01-1.88 2.185M18.75 4.5l-1.5 1.5m0 0l-1.5-1.5M18.75 4.5v9" /></svg>';
          btnText.textContent = 'Rielabora Testo';
        }, 3000);
        console.error(err);
      }
    }

    function copiaRisultato() {
      const output = outputText.innerText;
      const btnText = copiaBtn.querySelector('.text');
      const btnIcon = copiaBtn.querySelector('.icon');
      if (!output) {
        showStatus(outputStatus, "⚠️ Nessun risultato da copiare.", "warning");
        return;
      }
      navigator.clipboard.writeText(output).then(() => {
        copiaBtn.disabled = true;
        copiaBtn.classList.add('btn-success');
        btnIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg>';
        btnText.textContent = 'Copiato!';
        showStatus(outputStatus, "📋 Testo copiato negli appunti!", "success");
        setTimeout(() => {
          copiaBtn.disabled = false;
          copiaBtn.classList.remove('btn-success');
          btnIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75" /></svg>';
          btnText.textContent = 'Copia Risultato';
        }, 2000);
      });
    }

    function salvaContenuti() {
      localStorage.setItem('uniformatore_input', inputText.value);
      localStorage.setItem('uniformatore_output', outputText.innerText);
      showStatus(inputStatus, "💾 Contenuti salvati nel browser!", "success");
    }

    function cancellaTutto() {
      if (confirm("Sei sicuro di voler cancellare tutto, inclusi i dati salvati?")) {
        inputText.value = '';
        outputText.innerText = '';
        localStorage.removeItem('uniformatore_input');
        localStorage.removeItem('uniformatore_output');
        autoResizeTextarea(inputText);
        showStatus(inputStatus, "🗑️ Tutti i contenuti sono stati cancellati.", "info");
        setTimeout(() => inputStatus.classList.remove('show'), 3000);
      }
    }
    
    function showStatus(element, message, type, isSticky = false) {
      element.className = `status ${type} show`;
      element.textContent = message;
      if (!isSticky) {
        setTimeout(() => { element.classList.remove('show'); }, 4000);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const savedInput = localStorage.getItem('uniformatore_input');
      const savedOutput = localStorage.getItem('uniformatore_output');
      if (savedInput) {
        inputText.value = savedInput;
        autoResizeTextarea(inputText);
      }
      if (savedOutput) {
        outputText.innerText = savedOutput;
      }
      inputText.addEventListener('input', () => autoResizeTextarea(inputText));
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'Enter') {
          e.preventDefault();
          uniforma();
        }
      });
    });
  </script>
</body>
</html>
